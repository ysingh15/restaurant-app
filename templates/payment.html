{% extends "layout.html" %}
{% block content %}

<h4 class="mb-3 glow">Payment</h4>

<div class="row g-3">

  <!-- PAYMENT FORM -->
  <div class="col-lg-7">
    <div class="card p-3">

      <h5 class="mb-3">Card payment (demo)</h5>
      <p class="muted mb-3">
        This is a simulated payment form for coursework only.
        No real payment is processed.
      </p>

      <form method="post" action="/payment" class="row g-3">

        <!-- NAME ON CARD -->
        <div class="col-12">
          <label class="form-label">Name on card</label>
          <input
            class="form-control"
            name="card_name"
            placeholder="e.g. Yuvraj Singh"
            required
          >
        </div>

        <!-- CARD NUMBER -->
        <div class="col-12">
          <label class="form-label">Card number</label>
          <input
            class="form-control"
            name="card_number"
            placeholder="1234 5678 9012 3456"
            inputmode="numeric"
            maxlength="19"
            oninput="formatCardNumber(this)"
            required
          >
        </div>

        <!-- EXPIRY -->
        <div class="col-md-6">
          <label class="form-label">Expiry (MM/YY)</label>
          <input
            class="form-control"
            name="exp"
            placeholder="MM/YY"
            maxlength="5"
            oninput="formatExpiry(this)"
            required
          >
        </div>

        <!-- CVC -->
        <div class="col-md-6">
          <label class="form-label">CVC</label>
          <input
            class="form-control"
            name="cvc"
            placeholder="123"
            inputmode="numeric"
            maxlength="4"
            oninput="numbersOnly(this)"
            required
          >
        </div>

        <!-- BILLING POSTCODE -->
        <div class="col-12">
          <label class="form-label">Billing postcode</label>
          <input
            class="form-control"
            name="billing_postcode"
            placeholder="e.g. SW1A 1AA"
            required
          >
        </div>

        <!-- AUTHORISATION -->
        <div class="col-12">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="agree"
              name="agree"
              value="1"
              required
            >
            <label class="form-check-label" for="agree">
              I confirm I am authorised to use this payment method.
            </label>
          </div>
        </div>

        <!-- PAY -->
        <div class="col-12 d-grid">
          <button class="btn btn-success btn-lg" type="submit">
            Pay Now
          </button>
        </div>

      </form>
    </div>
  </div>

  <!-- DELIVERY SUMMARY -->
  <div class="col-lg-5">
    <div class="card p-3">
      <h5 class="mb-3">Delivery details</h5>

      {% set d = session.get("checkout", {}) %}
      <div class="mb-2"><strong>Name:</strong> {{ d.get("full_name","") }}</div>
      <div class="mb-2"><strong>Phone:</strong> {{ d.get("phone","") }}</div>
      <div class="mb-2"><strong>Address:</strong> {{ d.get("address1","") }}</div>

      {% if d.get("address2") %}
        <div class="mb-2"><strong>Address 2:</strong> {{ d.get("address2","") }}</div>
      {% endif %}

      <div class="mb-2"><strong>City:</strong> {{ d.get("city","") }}</div>
      <div class="mb-2"><strong>Postcode:</strong> {{ d.get("postcode","") }}</div>

      <hr>

      <a class="btn btn-outline-light w-100" href="/checkout">
        Edit delivery details
      </a>
    </div>
  </div>

</div>

<!-- INPUT RESTRICTIONS SCRIPT -->
<script>
  function numbersOnly(input) {
    input.value = input.value.replace(/\D/g, "");
  }

  function formatCardNumber(input) {
    let value = input.value.replace(/\D/g, "").slice(0, 16);
    input.value = value.replace(/(.{4})/g, "$1 ").trim();
  }

  function formatExpiry(input) {
    let value = input.value.replace(/\D/g, "").slice(0, 4);
    if (value.length >= 3) {
      input.value = value.slice(0, 2) + "/" + value.slice(2);
    } else {
      input.value = value;
    }
  }
</script>

{% endblock %}
