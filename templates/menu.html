{% extends "layout.html" %}
{% block content %}

<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
  <h4 class="mb-0 glow">Menu</h4>

  {% if categories is defined %}
  <form method="get" action="/menu" class="d-flex gap-2">
    <select class="form-select" name="category" onchange="this.form.submit()">
      <option value="">All categories</option>
      {% for c in categories %}
        <option value="{{ c }}" {% if selected == c %}selected{% endif %}>
          {{ c }}
        </option>
      {% endfor %}
    </select>

    {% if selected %}
      <a class="btn btn-outline-light" href="/menu">Clear</a>
    {% endif %}
  </form>
  {% endif %}
</div>

{% if items %}
<div class="row">
  {% for i in items %}
  {% set cat = (i.category or "")|lower %}

  <div class="col-md-4 mb-4">
    <div class="card p-3 menu-card">

      <!-- IMAGE (logo.png fallback) -->
{% if i.image %}
  <img
    src="{{ url_for('static', filename='images/' ~ i.image) }}"
    class="img-fluid rounded-3 mb-3"
    style="height: 170px; width: 100%; object-fit: cover;"
    alt="{{ i.name }}"
  >

{% endif %}

      <!-- TITLE + ICON -->
      <div class="menu-title mb-2">
        <div class="icon-bubble">
          {% if "dessert" in cat %}ğŸ°
          {% elif "drink" in cat or "bever" in cat %}ğŸ¥¤
          {% elif "side" in cat %}ğŸŸ
          {% elif "starter" in cat %}ğŸ¥—
          {% else %}ğŸ—
          {% endif %}
        </div>

        <div>
          <div class="fw-bold fs-5 glow">{{ i.name }}</div>
          <div class="mt-1">
            <span class="chip">{{ i.category }}</span>
          </div>
        </div>
      </div>

      <!-- DESCRIPTION -->
      {% if i.description %}
        <div class="muted">{{ i.description }}</div>
      {% else %}
        <div class="muted">Freshly prepared.</div>
      {% endif %}

      <!-- PRICE -->
      <div class="mt-3 fw-semibold fs-5">
        Â£{{ "%.2f"|format(i.price) }}
      </div>

      <!-- ADD TO CART -->
      <form method="post" action="/cart/add/{{ i.id }}" class="mt-3">
        <button class="btn btn-primary w-100">
          Add to cart
        </button>
      </form>

    </div>
  </div>

  {% endfor %}
</div>
{% else %}
<p class="muted">
  No menu items yet.
  {% if session.get("role") == "admin" %}
    Go to <a href="/admin/menu">Admin</a> to add items.
  {% endif %}
</p>
{% endif %}

{% endblock %}
