{% extends "layout.html" %}
{% block content %}

<h4 class="mb-3">Admin: Menu Management</h4>

<div class="d-flex gap-2 mb-3">
  <a class="btn btn-warning" href="{{ url_for('web.admin_run_daily_summary') }}">
    Generate Daily Summary
  </a>
  <a class="btn btn-outline-light" href="{{ url_for('web.menu') }}">
    View Menu Page
  </a>
</div>


<!-- CREATE -->
<div class="card p-3 mb-4">
  <h5 class="mb-3">Add New Item</h5>

  <!-- ✅ enctype added -->
  <form method="post" action="/admin/menu/create" class="row g-2" enctype="multipart/form-data">
    <div class="col-md-3">
      <input class="form-control" name="name" placeholder="Name" required>
    </div>
    <div class="col-md-2">
      <input class="form-control" name="category" placeholder="Category" value="Main">
    </div>
    <div class="col-md-2">
      <input class="form-control" name="price" placeholder="Price (e.g., 9.99)" required>
    </div>

    <!-- ✅ file upload replaces filename input -->
    <div class="col-md-5">
      <input class="form-control" type="file" name="image" accept=".png,.jpg,.jpeg">
      <small class="muted">Upload an image (png/jpg). It will be saved to static/images.</small>
    </div>

    <div class="col-md-12">
      <input class="form-control" name="description" placeholder="Description">
    </div>
    <div class="col-md-12">
      <button class="btn btn-primary">Add Item</button>
    </div>
  </form>
</div>

<!-- READ + UPDATE + DELETE -->
<div class="card p-3">
  <h5 class="mb-3">Existing Items</h5>

  {% if not items %}
    <p class="muted mb-0">No menu items yet.</p>
  {% else %}
    {% for i in items %}
      <div class="border rounded-4 p-3 mb-3" style="border-color: rgba(255,255,255,0.12) !important;">

        <!-- ✅ enctype added -->
        <form method="post" action="/admin/menu/update/{{ i.id }}"
              class="row g-2 align-items-end"
              enctype="multipart/form-data">

          <div class="col-md-3">
            <label class="form-label mb-1">Name</label>
            <input class="form-control" name="name" value="{{ i.name }}" required>
          </div>

          <div class="col-md-2">
            <label class="form-label mb-1">Category</label>
            <input class="form-control" name="category" value="{{ i.category }}">
          </div>

          <div class="col-md-2">
            <label class="form-label mb-1">Price</label>
            <input class="form-control" name="price" value="{{ "%.2f"|format(i.price) }}" required>
          </div>

          <!-- file upload for update -->
          <div class="col-md-3">
            <label class="form-label mb-1">Image (upload to replace)</label>
            <input class="form-control" type="file" name="image" accept=".png,.jpg,.jpeg">
            {% if i.image %}
              <small class="muted">Current: {{ i.image }}</small>
            {% else %}
              <small class="muted">No image yet</small>
            {% endif %}
          </div>

          <div class="col-md-2 d-grid">
            <button class="btn btn-success btn-sm" type="submit">Save</button>
          </div>

          <div class="col-md-12">
            <label class="form-label mb-1 mt-2">Description</label>
            <input class="form-control" name="description" value="{{ i.description or '' }}">
          </div>

        </form>

        <form method="post" action="/admin/menu/delete/{{ i.id }}" class="mt-2">
          <button class="btn btn-outline-light btn-sm" type="submit"
                  onclick="return confirm('Delete this item?');">
            Delete
          </button>
        </form>

      </div>
    {% endfor %}
  {% endif %}
</div>

{% endblock %}
